# **Re-ranking Person Re-identifification with** 𝑘-reciprocal Encoding

## 一.摘要

在本文中，我们提出了一种𝑘-reciprocal编码方法来重新排序re-ID(re-identifification)结果。

我们的假设是，如果在k相互近邻中一个图库中的图像与搜索图像相似，那么它更有可能是一个真正的匹配。

具体地说，给定一幅图像，通过将其𝑘相互近邻编码为一个向量来计算𝑘相互特征，用于在Jaccard距离下重新排序。最终的距离被计算为原始距离和Jaccard距离的组合。

我们的重新排序方法不需要任何人工交互或任何有标记的数据，因此它适用于大规模的数据集。

在Market-1501, CUHK03, MARS,  PRW数据集上进行实验



## 二.引言

在获得初始排名列表后，一个好的方法是添加一个重新排序步骤，期望相关图像得到更高的排名。因此，在本文中，我们将重点关注重新排序的问题。

重新排序的研究主要集中在通用实例检索[6,15,35,36]中。

重新排序的有效性在很大程度上取决于初始排名列表的质量。

![image-20220410144918383](C:\Users\13449\AppData\Roaming\Typora\typora-user-images\image-20220410144918383.png)

P1、P2、P3和P4是与搜索图像相匹配的4个真实匹配项，但它们都不包括在前4名中。我们观察到一些错误匹配（N1-N6）得到了较高的排名。蓝色和绿色的方框分别对应于搜索图像和正向匹配图像。我们可以观察到，搜索图像和正向匹配图像是10个相互的最近邻。

k-相互近邻是一个有效解决手段对在top-𝑘图像中的错误匹配影响问题

当两幅图像被称为𝑘-相互最近邻时，当另一幅图像作为搜索图像时，它们都被排名为top-𝑘。因此，无论两幅图像是否真匹配，𝑘-相互最近邻都是一个更严格的规则。

k-相互近邻的步骤:

1.我们将加权的𝑘相互近集编码为一个向量

2.通过两幅图像的𝑘-相互特征，可以计算出两幅图像之间的Jaccard距离。其次，为了获得更鲁棒的𝑘-相互特征，我们开发了一种局部查询扩展方法来进一步提高re-ID的性能。

3..最后，最终的距离计算为原始距离和Jaccard距离的加权聚合。它随后被用来获得重新排序的列表。

![image-20220410145754555](C:\Users\13449\AppData\Roaming\Typora\typora-user-images\image-20220410145754555.png)

框架如图所示，给定一个探针𝑝和一个图库，提取每个人的外观特征和𝑘-相互特征。然后计算每对探测人员和图库人员的原始距离𝑑和Jaccard𝑑𝐽。最终的距离𝑑∗计算为𝑑和𝑑𝐽的组合，用于获得所提出的排名列表。



## 三.相关工作



## 四.研究

### 4.1 问题定义

给定一个探测人员𝑝和有𝑁个图像的图像集 **g**=${\{g_i|i=1,2...N\}}$

p和$g_i$的原始距离可以用马氏距离$d(p,g_i)=(x_p-x_{g_i})^TM(x_p-x_{g_i}))$   M是一个半正定矩阵

原始的排序列表可以使用马氏距离获得$L(p,g)=\{g_1^0,g_2^0.....g_N^0\}$ 其中$d(p,g_i^0)<d(p,g_{i+1}^0)$

我们的目标是对ℒ（𝑝，𝒢）进行重新排序，从而使更多的正向样本在列表中排名在前，从而提高人的再识别(re-ID)的性能

### 4.2 k相互近邻

定义𝑁（𝑝，𝑘）作为一个探针𝑝的𝑘-最近邻(即排名列表中的top-𝑘样本)

$N(p,k)=\{g_1^0,g_2^0.....g_k^0\}$,   $|N(p,k)|=k$

k相互近邻被定义为ℛ(𝑝, 𝑘)

![image-20220410152618494](C:\Users\13449\AppData\Roaming\Typora\typora-user-images\image-20220410152618494.png)

𝑘-相互最近邻比𝑘-最近邻更与探测𝑝相关

然而，由于光照、姿态、视图和遮挡的变化，正向图像可能被排除在𝑘最近邻之外，可能会导致不包括在𝑘相互最近邻中。

为了解决这个问题，我们根据以下条件，将ℛ（𝑝，𝑘）中每个候选项的$\frac 12$个𝑘-相互最近邻增量地添加到一个更鲁棒的集合ℛ∗（𝑝，𝑘）中

![image-20220410152844805](C:\Users\13449\AppData\Roaming\Typora\typora-user-images\image-20220410152844805.png)

通过这个操作，我们可以在ℛ∗（𝑝，𝑘）中添加更多的正向样本，它们更类似于ℛ（𝑝，𝑘）中的候选样本，而不是探针𝑝。

![image-20220410153159295](C:\Users\13449\AppData\Roaming\Typora\typora-user-images\image-20220410153159295.png)

因此，经过膨胀过程，可以在ℛ∗（𝑝，𝑘）中加入更多的正向样本。与[35]不同的是，我们不直接将ℛ∗（𝑝，𝑘）中的候选人作为排名最高的图像。相反，我们将ℛ∗（𝑝，𝑘）作为上下文知识来重新计算探针和图库之间的距离

### 4.3 **Jaccard Distance**

如前面所述的[2][46]，我们认为如果两幅图像是相似的，则它们的相互最近邻集重叠，即集合中存在一些重复的样本。重复的样本越多，这两幅图像就越相似。𝑝和𝑔𝑖之间的新距离可以通过它们的𝑘-倒数集的Jaccard度量来计算为

![image-20220410153949763](C:\Users\13449\AppData\Roaming\Typora\typora-user-images\image-20220410153949763.png)



虽然上述方法可以捕捉到两幅图像之间的相似性关系，但仍有三个明显的缺点：

1.在很多情况下，得到两个邻集ℛ∗（𝑝，𝑘）和ℛ∗（𝑔𝑖，𝑘）的交集和并集非常耗时，并且当需要计算所有图像对的Jaccard距离时，它变得更具挑战性。另一种方法是将邻域集编码为一个更简单但等价的向量，大大降低了计算复杂度，同时保持邻域集的原始结构。

2.距离计算方法对所有邻居的权重相等，得到一个简单但没有区别的邻居集。事实上，更接近探测𝑝的邻居更有可能是真正性。因此，根据原始距离重新计算权值，并对较近的样本分配较大的权值是令人信服和合理的。

3.当试图衡量两个人之间的相似性时，简单地考虑到上下文信息将会造成相当大的障碍，因为不可避免的变化使得很难区分足够的上下文信息。因此，合并原始距离和Jaccard距离对于一个稳健的距离变得非常重要。



**解决上述问题**

受[2]的启发，提出了𝑘-相互特征来解决前两个缺点，即将𝑘-相互最近邻集编码为一个向量$𝒱𝑝=[𝒱_{𝑝，𝑔1}，𝒱_{𝑝，𝑔2}，...，𝒱_{𝑝，𝑔𝑁}]$，其中$𝒱_{𝑝，𝑔𝑖}$最初由一个二进制指标函数定义为

![image-20220410154532045](C:\Users\13449\AppData\Roaming\Typora\typora-user-images\image-20220410154532045.png)

这样，𝑘-相互邻域集就可以表示为一个𝑁维向量，该向量中的每一项都表示相应的图像是否包含在ℛ∗（𝑝，𝑘）中。

然而，这个函数仍然认为每个邻居都是相等的。

因此，我们根据探针与其邻居之间的原始距离重新分配权值，我们重新定义等式6由成对距离的高斯核数为

![image-20220410154939698](C:\Users\13449\AppData\Roaming\Typora\typora-user-images\image-20220410154939698.png)

根据上述定义，交集和并集中的候选数可以计算为

![image-20220410155101095](C:\Users\13449\AppData\Roaming\Typora\typora-user-images\image-20220410155101095.png)

![image-20220410155147364](C:\Users\13449\AppData\Roaming\Typora\typora-user-images\image-20220410155147364.png)

### 4.4局部查询扩展

为了模拟来自同一个类的图像可能共享相似的特性，我们使用探针𝑝的𝑘-最近邻来实现局部查询扩展。本地查询扩展被定义为

![image-20220410160222812](C:\Users\13449\AppData\Roaming\Typora\typora-user-images\image-20220410160222812.png)

因此，𝑘-相互特征𝒱𝑝被探针𝑝的𝑘-最近邻展开。请注意，我们在探针𝑝和图库𝑔𝑖上都实现了这个查询扩展。

由于𝑘最近邻中会有噪声，我们将本地查询扩展中使用的𝑁（𝑝，𝑘）的大小限制在更小的值。

为了区分等式中使用的ℛ∗（𝑔𝑖，𝑘）和𝑁（𝑝，𝑘）的大小7和等式11，我们分别将前者表示为𝑘1，后者表示为𝑘2，其中𝑘1>𝑘2。

### 4.5最终距离

现有的重新排序方法在重新排序中忽略了原始距离的重要性，我们将原始距离和Jaccard距离合并来修改初始排序列表，最终距离𝑑∗定义为

![image-20220410160628430](C:\Users\13449\AppData\Roaming\Typora\typora-user-images\image-20220410160628430.png)

其中，𝜆∈[0,1]表示惩罚因子，它惩罚远离探针𝑝的图库。当𝜆=为0时，只考虑k-相互距离。相反，当𝜆=1时，只考虑原始距离。𝜆的作用将在第4节中进行讨论。最后，通过对最终距离的上升排序，可以得到修正后的排名列表ℒ∗（𝑝，𝒢）。