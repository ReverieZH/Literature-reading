# Weakly supervised fine-grained image classification via two-level attention activation model

细粒度的图像分类具有挑战性，因为类别只能通过细微的和局部的差异来区分。现有的弱监督细粒度图像分类方法通常直接从高级特征图中提取鉴别区域。

我们观察到，在卷积神经网络中叠加局部感受域的操作使得区分区域在高级特征图中扩散，从而导致区域定位不准确。

本文提出了一种端到端两级注意激活模型(TL-AAM)，它可以解决区分区域扩散的问题，获得更有效的细粒度特征。

.具体来说，TL-AAM由：

（1）对象注意激活模块(OAAM)，使用目标区域定位链接正确的分类分数 ，通过梯度回流，以相互强化的方式精确定位目标区域，

（2）多尺度金字塔注意定位模块(MPALM)，定位局部特征区域的区域，该模块可以准确地获得局部区域的详细特征

（3）局部跨通道注意模块(LCAM)，通过对特征图中响应值较高的特征通道给予更高的权重，可以过滤高级语义特征图中的无关信息。

大量的实验验证了TL-AAM在相同的设置下与最竞争的方法产生最先进的性能，在CUB-200-2011，FGVC-飞机，斯坦福和汽车数据集。

# **1. Introduction**

以细粒度图像分类为目标来区分不同子类别中的对象，近年来引起了学术界和工业界的广泛关注。由于属于同一类别的物体具有相似的物理结构，物体之间的差异很小；然而，属于同一子类别的物体的不同姿势、不同的拍摄角度、光照和遮挡可能会造成较大的差异。正是因为细粒度图像分类数据集具有类间差异小、类内差异大的特点，使得细粒度图像分类比传统图像分类更具挑战性。

.为了克服这些挑战，最近有许多相关的研究致力于利用注意机制来发现不同子类别之间的细微差异。

RA-CNN (Fu et al.， 2017)提出了一种新的循环注意卷积神经网络，递归学习多尺度判别区域和基于区域的特征表示以相辅相成的方式。

MA-CNN(Zhengetal.，2017)设计了一个多注意力卷积神经网络，其中包含卷积、信道分组和部分分类子网络；这三个子网络共同促进MA-CNN产生更多的区别部分。

TASN(Zhengetal.，2019a)提出了一个三线性注意抽样网络来学习微妙的特征表示，该网络通过学生-教师方式的知识提取进行优化。



大部分的工作都致力于寻找目标的关键区域，而关键区域的定位对于协助细粒度的图像分类非常重要。

近年来的主流方法大多利用注意机制来寻找关键领域，并取得了良好的效果。然而，现有的基于注意力的细粒度图像分类方法大多直接使用特征图的像素值来定位目标区域，如对特征图进行平均。

通过特征贴图进行直接定位存在以下缺陷：

（1）由于不同的特征通道对关键信息的贡献不同，因此直接平均所有特征的操作
通道将在整个特征图中划分对象区域受到非相关信息的干扰，最终导致目标定位区域不准确。

（2）通过特征提取网络获得的特征图，其中不同的特征通道包含不同的模式信息，且存在仅包含背景信息或其他冗余信息的特征通道。这些不重要的通道可能会影响最终的细粒度图像分类。



为了解决上述问题，我们提出了目标注意激活模块(OAAM)来定位目标对象，这是一种从全局图像中获取目标区域的新方法。我们的主要思想是使用梯度回流来计算卷积特征图上的最终分类得分的梯度，然后使用梯度来确定卷积特征图中的哪些像素对最终的分类有积极的影响。

与传统的注意机制方法不同，OAAM不直接操纵特征地图获得注意地图，但通过梯度回流建立最终分类决策和特征地图之间的联系，从而生成对应的热图，然后定位目标对象所在的区域，我们使用GradCAM++(etal.，2018)对热图进行分析，然后获得局部显著特征。然后，我们将定位的目标图像输入分类网络，得到分类结果并重新计算梯度，并根据新的梯度值生成新的热图和新的定位图。

![image-20220725140916196](D:\文献阅读\Recent deveopments of CBIR\40 SCDA\image\image-20220725140916196.png)

如图1所示，由于基线方法(MMAL-Net)在定位过程中没有考虑特征图与最终分类决策之间的联系，最终可视化的特征图没有完全关注对象；而OAAM模块在训练过程中可以连续引导卷积神经网络关注目标目标区域（即地图中颜色较亮的区域），然后定位目标目标区域，有效排除了背景信息的干扰。

为了进一步提高细粒度图像分类的有效性，我们还需要捕获对象图像上特定于类的细微特征，如鸟的喙和尾巴。如图2所示，CUB-200-2011(Wahetal.，2011)数据集中的美国乌鸦和鱼乌鸦看起来非常相似，普通人一般无法区分它们。鸟类专家倾向于关注当地的细微特征，如头部、翅膀和尾巴，并根据这些细微特征的差异来确定它们的物种。受专家识别方法的启发，我们也打算定位这些有鉴别性的局部区域。为了定位这些局部的细微差别区域，我们提出了多尺度金字塔注意定位模块(MPALM)。由于目标图像已经被过滤掉了大部分的背景信息，所以我们直接将它们再次输入特征提取网络，得到相应的卷积特征图。MPALM通过卷积特征图得到精细特征所在的区域，然后截取局部的精细特征，分别发送到分类网络中，可以有效地提高细粒度图像分类的精度。

![image-20220725150659927](D:\文献阅读\Recent deveopments of CBIR\40 SCDA\image\image-20220725150659927.png)

另外，由于主干网络获得的特征图中的不同的特征通道包含不同的模式信息，因此存在只包含背景信息或其他冗余信息的特征通道。这些不重要的通道会影响目标区域的位置，进而影响最终的分类结果。因此，我们在主干网络中使用了局部跨通道注意模块(LCAM)，这可以大大提高网络的性能，从而提高了细粒度图像分类的精度。

我们的主要贡献可以总结如下：

- 我们提出一个新的对象注意激活模块(OAAM)，与以前的注意模块，建立一个连接最终的分类决定和卷积特征地图通过梯度回流，以精确定位目标对象所在的区域，有效地排除图像背景信息的干扰。

- 我们设计了一个不同于传统定位模块的多尺度金字塔注意定位模块(MPALM)。该模块通过多尺度定位盒和最大响应定位方法，在目标图像对应的特征地图上定位不同的局部区域，从而捕获到各子类对象的独特局部特征，使网络模型能够更好地区分不同的对象子类，进一步提高细粒度图像分类的精度

- 我们在特征提取网络中对特征图进行可视化，发现存在只包含背景信息或其他冗余信息的特征通道，这些不重要的通道会影响最终的分类结果。因此，本文介绍了一种用于特征提取网络的局部跨通道注意模块(LCAM)。与现有的方法不同，该模块通过深度可分离卷积计算每个通道与其相邻通道之间的关系，并进一步为重要特征通道分配更高的权值，可以过滤高级语义特征图中更多的无关信息，最终获得更好的细粒度图像分类结果。

  

# **3. Proposed method**

![image-20220725151414967](D:\文献阅读\Recent deveopments of CBIR\40 SCDA\image\image-20220725151414967.png)

如图3所示，本文提出的模型称为两级注意激活模型(TL-AMM)，对象图像获得对象注意激活模块(OAAM)，和关键的局部区域进一步捕获多尺度锥体注意定位模块(MPALM)的基础上对象图像。模型名称中的术语“两级”指的是物体注意激活模块(OAAM)和多尺度金字塔式注意定位模块(MPALM)。

OAAM使用梯度回流来明确特征图上的哪些区域有利于最终的分类结果，从而准确地定位目标对象的区域。MPALM通过设计不同尺度的窗口，进一步将识别特征区域定位到目标目标区域，使网络学习到的特征更具有鲁棒性。

由于上述两个注意模块是互补的，因此多尺度金字塔定位模块基于目标注意激活模块进行进一步的精确定位，因此我们将整体网络模型命名为两级注意激活模型(TL-AAM)。

在本节中，我们介绍了物体注意激活模块(OAAM)、多尺度金字塔注意定位模块(MPALM)和局部跨通道注意模块(LCAM)。

其中，在第3.1节中，我们首先回顾了MMAL-Net中的AOLM模块(Zhangetal.，2021)，然后分析了其缺陷并进行了改进。因此，我们提出了物体注意激活模块(OAAM)。

## *3.1. Object attention activation module*

受SCDA(Wei等人，2017)的启发，MMAL-Net(Zhang等人，2021)提出了注意对象定位模块(AOLM)来定位目标对象。AOLM通过寻找卷积神经网络的焦点，有效地识别和准确地定位了我们所需要的目标目标区域。首先，让𝑭∈𝑅𝐾×𝐻×𝑊表示特征提取网络的最后一个卷积层后的输入图像的特征图，其中𝐾为特征图的通道数，𝐻×𝑊为空间维数。

AOLM通过对特征映射𝑭执行聚合操作来获得激活映射𝑨，它可以定义为：

![image-20220725151728502](D:\文献阅读\Recent deveopments of CBIR\40 SCDA\image\image-20220725151728502.png)

自激活地图𝑨响应深度神经网络的焦点区域，𝑨的平均值𝛼可以作为一个阈值来确定（𝑥𝑦）位置𝑨对应对象的一部分，与面具𝑴记录如下式所示：

![image-20220725151756123](D:\文献阅读\Recent deveopments of CBIR\40 SCDA\image\image-20220725151756123.png)

在从激活映射𝑨中获得相应的掩模𝑴后，通过找到该𝑴的最大连接面积来确定细粒度图像中的目标区域。

实验发现，上述现有的方法AOLM通过寻找卷积神经网络的焦点来定位目标目标区域，在一定程度上解决了背景信息干扰问题，提高了细粒度图像分类的精度。然而，AOLM通过对卷积特征映射的聚合和平均等简单的操作来直接获得激活映射映射，这是非常粗糙的。该方法没有考虑最终的分类结果与特征图中的目标区域之间的关系，因此存在定位不准确的问题。为了解决AOLM的缺点和更好地定位目标对象区域从原始图像，我们提出对象注意激活模块(OAAM)，将最终的分类得分与目标目标区域定位对象区域相互加强的方式，并最终可以获得比AOLM更好的结果。如图4所示，当鸟本身的颜色与背景相似时，OAAM比AOLM定位更准确。

![image-20220725151928166](D:\文献阅读\Recent deveopments of CBIR\40 SCDA\image\image-20220725151928166.png)

由于卷积神经网络由于缺乏可解释性而常被视为黑盒子，因此在自动驾驶等某些应用中，很难获得人类的信任。为了在深度学习模型中建立信任，研究人员在过去的几年里提出了各种方法来解释为什么网络模型会做出这个或那个的决定。

CAM (Zhou et al.， 2016)修正该结构的卷积神经网络，即取代了原始的全连接层和全局平均池化层然后对得到的特征图进行加权和组合，得到一个能显示网络焦点的热图为网络原因做出最终的分类决策。尽管CAM很简单，但它需要修改网络结构，因此需要对网络模型进行再训练，这极大地限制了其使用场景。

为了弥补CAM的缺点，GradCAM(Selvarajuetal.，2017)通过使用梯度的全局平均值来计算权重，生成一个不修改模型的热图。但是，当多个目标对象同时出现在一张图片中时，Grad-CAM甚至不能完全定位一个目标。因此，GradCAM++提出了Grad-CAM的推广方案，解决了多个目标同时出现的问题，进一步提高了目标定位的性能。

受GradCAM++（查塔帕德海等人，2018）的启发，我们提出了OAAM来定位目标对象。OAAM通过梯度回流到特征图来定位与目标对象对应的区域。输入图像首先经过特征提取网络,然后通过完全连接层获得每个类的预测成绩。OAAM计算到指定的卷积特征图的预测分数的梯度。因为一个正的梯度值表明像素对最终的分类有积极的影响，而负梯度有相反的效果，梯度是进一步处理使用ReLu激活函数，最后梯度的加权平均值获得卷积特征地图的权重。在获得卷积特征图的权值后，将指定的卷积特征图与得到的权值进一步加权得到热图，最后通过计算热图中的最大连接区域得到目标对象的定位框。

具体步骤如下：给定一个输入图像，首先由特征提取网络提取特征，然后由全连通层获得该图像所属的类别𝑐的预测得分𝑌𝑐。根据指定的卷积层的特征图𝑨，用以下公式计算出卷积特征图𝑨所需的权值𝑾𝒄：

![image-20220725152530020](D:\文献阅读\Recent deveopments of CBIR\40 SCDA\image\image-20220725152530020.png)

其中，𝐴𝑖𝑗为在空间位置上指定的卷积层的值（𝑖，𝑗）。这里𝑅𝑒𝐿𝑈是校正线性单位激活函数，它将保持正梯度并将负梯度设为0。

当得到卷积特征图𝑨所需的权值𝑾𝒄时，我们可以计算出特征图𝑨在不同空间位置（𝑖、𝑗）上对应的热图𝑳𝒄，公式如下：

![image-20220725152556800](D:\文献阅读\Recent deveopments of CBIR\40 SCDA\image\image-20220725152556800.png)

在获得热图𝑳𝒄后，通过视觉分析，我们发现热图可以反映原始图像中不同区域对正确分类的贡献，所以我们只需要找出热图中最大、响应值高的连接区域，然后将其映射到原始图像中进行裁剪，得到我们想要的目标对象区域。由于OAAM获得的热图反映了不同地区的贡献特征地图的分类，它有很高的信心定位对象区域的热图，可以得到更准确的目标区域，从而提高细粒度图像分类的准确性。图5为输入图像经过OAAM处理后获取目标对象图像的总体流程。

## *3.2. Multi-scale pyramid attention localization module*

由于细粒度的图像分类数据集极具挑战性，尽管排除了背景信息，但类之间的差异仍然很小。特别是对于鸟类数据集，不同的鸟类之间存在着非常小的差异，即使是鸟类专家也不能一眼分辨出这些类别，必须仔细比较鸟类之间的差异。如图6所示，我们展示了两行图像比较不同种类的鸟类、汽车和飞机，我们可以看到，在同一列是相对相似的，只有仔细比较当地细节（与矩形框）我们可以更好地分类。例如，在(b)列中，这两只鸟乍一看非常相似，但在仔细比较了头部、羽毛和脚后，我们可以看到它们属于不同的子类别。因此，我们设计了多尺度金字塔注意定位模块(MPALM)来进一步提取目标对象图像上的细微特征，然后将这些细微特征组成新的分支，输入分类网络，协助细粒度图像分类。

大量研究表明，卷积神经网络中更深层次的表示可以捕获更高层次的视觉信息(Bengioetal.，2013；马亨德兰和维达尔迪，2016)。此外，卷积层保留了图像的空间信息，但在全连接层中丢失了。因此，我们认为由最后一个卷积层得到的卷积特征图不仅包含了高层次的视觉结构，而且还保留了图像的空间信息。我们将通过OAAM模块获得的目标目标图像输入到主干网络中，得到最后一层的卷积特征图。由于卷积特征图的最后一层包含了丰富的视觉和空间信息，因此我们使用这个卷积特征图来寻找目标对象图像中的关键区域。MPALM的一个具体例子如图7所示。

![image-20220725152850393](D:\文献阅读\Recent deveopments of CBIR\40 SCDA\image\image-20220725152850393.png)

由于该卷积特征图包含大量的特征通道，并且每个特征通道学习不同的视觉模式信息，因此我们首先找出响应值最大的前K个特征通道。然后，我们从这K个特征通道中定位响应值最大的像素点，并将这个点集中到不同尺度大小的帧区域，然后进一步截断这些局部特征图，输入分类网络。算法1显示了多尺度金字塔定位的过程。其中，定位框架的比例尺寸在本文描述的实验环境中预定义，所述尺寸设置为{[96×96]，[160×160]，[224×224]}。实验表明，MPALM能够准确地捕获目标对象的细微特征，并在不增加计算量的情况下获得更好的分类结果。

![image-20220725153012410](D:\文献阅读\Recent deveopments of CBIR\40 SCDA\image\image-20220725153012410.png)

由于特征图中的特征通道不同 ，通过特征提取网络得到包含不同模式的特征 信息，存在只包含背景信息的特征通道  信息或其他冗余信息，这些不重要的通道会影响目标对象定位，进而影响最终的分类结果。受SENet(Hu等人，2018)和ECA-Net（启龙等人，2020）的启发，我们打算在特征提取网络中添加一个局部交叉通道注意模块(LCAM)，以提高网络的性能，从而提高细粒度图像分类的准确性。为了更直观地理解上述描述，我们分别在有LCAM和没有LCAM的卷积神经网络中对特征图进行了可视化。如图8所示，当图像在没有LCAM的情况下通过卷积神经网络时，存在对背景信息有高响应的特征映射；当图像通过具有LCAM的卷积神经网络时，对目标对象具有高响应的特征映射。

在本文中，我们使用了一种局部跨信道信息交互的方法，使网络能够在保证计算性能和模型复杂度的同时，为重要的信道分配更高的权重。具体处理方式如下：

给定一个聚合的特征通道𝒚∈R𝐶，该特征通道的注意学习可以用以下公式来描述：

![image-20220725153718396](D:\文献阅读\Recent deveopments of CBIR\40 SCDA\image\image-20220725153718396.png)

𝑾是一个大小为𝐶×𝐶的参数矩阵，𝝎是通道注意学习后的特征图

为了实现局部跨通道信息交互，我们对特征信道进行分组，每组包含𝑡信道。为了学习组内信道的相关性，我们使用波段矩阵𝑾𝒕来学习信道注意。

![image-20220725153902397](D:\文献阅读\Recent deveopments of CBIR\40 SCDA\image\image-20220725153902397.png)

𝑾𝒕包含𝑡×𝐶参数，参数𝑡表示一组通道中的信道数，参数𝐶表示卷积特征图中的信道总数。

我们使用带矩阵𝑾𝒕来学习组中信道的相关性，以便我们可以合理地重新分配适当的权值。因此，对于特征通道𝑦𝑖，只需要考虑它与𝑡邻居的信息交互，即：

![image-20220725154117561](D:\文献阅读\Recent deveopments of CBIR\40 SCDA\image\image-20220725154117561.png)

𝛺𝑡𝑖为𝑦𝑖的𝑡个相邻通道的集合。

基于以上分析，我们观察到该方法可以通过一个深度可分离的卷积来实现信道间的信息交互，即：

![image-20220725154203609](D:\文献阅读\Recent deveopments of CBIR\40 SCDA\image\image-20220725154203609.png)

𝑫𝑺𝑪𝑡表示与核大小为𝑡的深度可分离卷积。

如图9所示，在没有降维的信道池进行全局平均后，我们通过考虑每个信道及其𝑡邻居来捕获局部跨信道交互信息